try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})["__faroBundleId_gptengineer-app"]="17643622511421e367bf835"}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[312,1675],{169:(e,r,t)=>{t.d(r,{O:()=>o});var i=t(18502),a=t(83220),s=t(63851),n=t(69850);let o=e=>{var r;let{projectId:t,enabled:o=!0}=e,{currentUserSelectedWorkspaceId:l}=(0,a.Dx)(),c=o&&!!l,{data:d,isLoading:u}=(0,i.I)({queryKey:n.gO.remixPreflight(t,l),queryFn:async()=>l?(0,s.P)().post("/projects/".concat(t,"/remix/preflight"),{workspace_id:l}):null,enabled:c});return{isProjectRemixAllowed:!(null==(r=null==d?void 0:d.remix_not_allowed)||r),hasCheckedProjectRemixAllowed:!!d||!c,projectRemixNotAllowedReason:(null==d?void 0:d.reason)||"Remixing this project is not possible.",isLoading:u}}},5361:(e,r,t)=>{function i(e){let r=null==e?void 0:e.trim();if(!r||r.startsWith("//"))return"/";if(r.startsWith("/"))return r;try{if(new URL(r,window.location.origin).origin===window.location.origin)return r}catch(e){}return"/"}function a(e){return e?i(e):"/"}t.d(r,{S:()=>i,U:()=>a})},8293:(e,r,t)=>{t.d(r,{O:()=>c});var i=t(87299),a=t(13410),s=t(95661),n=t(83220),o=t(63851),l=t(69850);let c=e=>{let{onComplete:r,onError:t,shouldNavigate:c=!1}=e,d=(0,a.useRouter)(),u=(0,i.jE)(),{currentUserSelectedWorkspaceId:m}=(0,n.Dx)(),p=(0,s.useRef)(null),[g,h]=(0,s.useState)(null),[f,x]=(0,s.useState)(null),w=(0,s.useRef)(r),j=(0,s.useRef)(t),v=(0,s.useRef)(!1),y=(0,s.useRef)(!1);(0,s.useEffect)(()=>{w.current=r,j.current=t},[r,t]);let b=(0,s.useCallback)(()=>{p.current&&(clearInterval(p.current),p.current=null)},[]);return(0,s.useEffect)(()=>{if(!f)return;let{projectId:e,jobId:r}=f,t=async()=>{try{let t=await (0,o.P)().get("/projects/".concat(e,"/remix/progress?job_id=").concat(r));if(!t)throw Error("Failed to get progress");if(h(t),"completed"===t.status){if(v.current)return;v.current=!0,b(),m&&u.invalidateQueries({queryKey:l.workspaceKeys.detail(m)}),c&&d.push("/projects/".concat(t.result.project_id,"?remixed=true")),w.current(t.result)}else if("error"===t.status){if(y.current)return;y.current=!0,b(),j.current()}}catch(e){if(y.current)return;y.current=!0,b(),j.current()}};return p.current=setInterval(t,1e3),t(),()=>{b()}},[f,c,d,u,m,b]),{currentJobState:g,startPolling:(0,s.useCallback)((e,r)=>{b(),v.current=!1,y.current=!1,x({projectId:e,jobId:r})},[b]),stopPolling:(0,s.useCallback)(()=>{b(),x(null)},[b])}}},11070:(e,r,t)=>{t.d(r,{K:()=>f,N:()=>x});var i=t(92912),a=t(75222),s=t(63851),n=t(19620),o=t(72632),l=t(51573),c=t(69850),d=t(62548),u=t(74507),m=t(83473),p=t(39528),g=t(32736);let h=async(e,r,t)=>{try{let a=(0,s.P)();await a.post("/workspaces/".concat(e,"/campaigns/").concat(r,"/redeem/").concat(t)),i.Ay.capture(p.yx.REWARD.REDEEMED,{campaign:r,reward_code:t,workspace_id:e});return}catch(s){let a;throw n.logging.error("Failed to redeem campaign reward",{error:s,workspaceId:e,campaignName:r,rewardCode:t}),a=s instanceof Error?s:Error("Unknown error occurred while redeeming reward",{cause:s}),i.Ay.capture(p.yx.REWARD.REDEEM_FAILED,{campaign:r,reward_code:t,workspace_id:e,error_message:a.message}),a}},f={key:g.A.CLAIM_REWARD,paramsSchema:a.Ik({campaignId:a.Yj().regex(/^[a-zA-Z0-9-]+$/),rewardCode:a.Yj().regex(/^[a-zA-Z0-9-]+$/)}),execute:async(e,r)=>{let{campaignId:t,rewardCode:i}=e,{workspaces:a,selectedWorkspaceId:s}=r,n=s;return(!n&&a&&a.length>0&&(n=(e=>{if(1===e.length){let r=e[0],{isPaidPlan:t}=(0,o.cb)(r.plan);if(!t)return r.id}return null})(a)),n)?(await h(n,t,i),{redirectUrl:"/?change_type=upgrade&payment_status=success",invalidateQueries:[c.workspaceKeys.all],workspaceUpdate:{workspaceId:n,updates:{plan:l.VL.KTLO}}}):{redirectUrl:"/lp/".concat(t,"?reward_code=").concat(i)}}},x={key:g.A.REMIX_PROJECT,paramsSchema:a.Ik({projectId:a.Yj().regex(/^[a-zA-Z0-9_-]+$/),initialMessage:a.Ik({id:a.Yj(),message:a.Yj(),files:a.YO(a.Ik({file_id:a.Yj(),type:a.fc(d.g),file_name:a.Yj().optional(),mime_type:a.Yj().optional()})).optional(),selected_elements:a.YO(a.bz()).length(0),chat_only:a.zM().optional()}).optional()}),execute:async(e,r)=>{let{projectId:t}=e,{workspaces:i,selectedWorkspaceId:a}=r;try{var o;let r,l=(0,s.P)(),d=0;for(;d<3;)try{r=await l.get("/permissions?projectId=".concat(t));break}catch(e){if(++d>=3)return n.logging.error("Failed to fetch permissions after retries",{error:e,projectId:t,retries:d}),{redirectUrl:"/projects/".concat(t)};await new Promise(e=>setTimeout(e,1e3*d))}let m=r.includes(u.eZ.EditProject),p=r.includes(u.eZ.RemixProject);if(m)return{redirectUrl:"/projects/".concat(t)};if(!p)return{redirectUrl:"/"};let g=a||(null==i||null==(o=i[0])?void 0:o.id);if(!g)return n.logging.error("No workspace available for remix",{projectId:t}),{redirectUrl:"/"};let h=await l.get("/projects/".concat(t,"/details")),f=h.display_name||h.name||t,x={include_history:!1,include_custom_knowledge:!1,workspace_id:g,initial_message:e.initialMessage},w=await l.post("/projects/".concat(t,"/remix/init"),x);return localStorage.setItem("pendingRemixJob",JSON.stringify({jobId:w.job_id,projectId:t,projectName:f,timestamp:Date.now()})),{redirectUrl:"/",invalidateQueries:[c.gO.all]}}catch(e){return n.logging.error("Failed to execute remix project action",{error:e,projectId:t}),(0,m.Ni)(e),{redirectUrl:"/projects/".concat(t)}}}}},19286:(e,r,t)=>{t.d(r,{T:()=>m});var i=t(77145),a=t(96373),s=t(30849),n=t(13410),o=t(95661),l=t(40702),c=t(20247),d=t(27458),u=t(56024);let m=e=>{let{title:r,description:t,showLoggedInAs:m=!1,children:p,blurOverlay:g=!1,blockClosingOnInteractOutside:h=!1,size:f="sm",customHandleSignOut:x,showBanner:w=!1,onClose:j,hideCloseButton:v}=e,{authUser:y}=(0,l.Z2)(),b=(0,n.useRouter)(),k=(0,n.usePathname)(),N=(0,n.useSearchParams)(),I=async()=>{if(x)return void await x();await fetch("/api/logout"),b.refresh()},S=(0,o.useCallback)(()=>{let e=encodeURIComponent("".concat(k,"?").concat(N.toString()));b.push("/login?redirect=".concat(e))},[b,k,N]);return(0,i.jsxs)(c.Cf,{className:(0,u.cn)({"min-w-[454px] p-4":w}),size:f,blurOverlay:g,onInteractOutside:e=>{h?e.preventDefault():null==j||j()},onEscapeKeyDown:e=>{h?e.preventDefault():null==j||j()},hideCloseButton:w||v,onClose:j,children:[w&&(0,i.jsxs)("div",{className:"relative h-48 w-full overflow-hidden rounded-lg",children:[(0,i.jsx)(s.default,{src:"/img/built-by-lovable.png",alt:"Built by Lovable",fill:!0,className:"object-cover"}),(0,i.jsx)("span",{className:"absolute inset-x-0 bottom-0 flex h-full items-center justify-center text-center text-3xl font-semibold text-white",children:"Built with Lovable"})]}),(0,i.jsxs)(c.c7,{children:[!w&&(0,i.jsx)(d.Fy,{className:"mb-2 h-9 w-9"}),r?(0,i.jsx)(c.L3,{className:"text-2xl font-medium",children:r}):(0,i.jsx)(a.s6,{children:(0,i.jsx)(c.L3,{className:"text-2xl font-medium",children:r})}),(0,i.jsx)(c.rr,{className:"text-sm text-muted-foreground",children:t})]}),p,m?y?(0,i.jsxs)("div",{className:"mt-2 text-center text-xs text-muted-foreground",children:[(0,i.jsxs)("span",{children:["You are logged in as ",y.email,"."]})," ",(0,i.jsx)("span",{className:"cursor-pointer underline",tabIndex:0,role:"link",onClick:I,children:"Not you?"})]}):(0,i.jsxs)("div",{className:"mt-2 text-center text-xs text-muted-foreground",children:[(0,i.jsx)("span",{children:"Are you the owner?"})," ",(0,i.jsx)("span",{className:"cursor-pointer underline",tabIndex:0,role:"link",onClick:S,children:"Sign in"})]}):null]})}},25253:(e,r,t)=>{t.d(r,{o:()=>n});var i=t(92912),a=t(95661),s=t(39528);let n=()=>{let[e,r]=(0,a.useState)("default");(0,a.useEffect)(()=>{"Notification"in window&&r(Notification.permission)},[]);let t=(0,a.useCallback)(async e=>{let{onResolve:t,onGranted:a,onDenied:n}=e;if(!("Notification"in window))return console.warn("This browser does not support notifications"),!1;let o=await Notification.requestPermission();return r(o),"granted"===o&&(null==a||a(),i.bC.capture(s.$6.CHAT.NOTIFICATIONS_ENABLED)),"denied"===o&&(null==n||n()),null==t||t(),"granted"===o},[]),n=(0,a.useCallback)((r,t)=>{if("granted"===e&&document.hidden)try{return new Notification(r,{icon:"/img/logo/favicon.ico",badge:"/img/logo/lovable-logo-icon.svg",...t})}catch(e){console.warn("Failed to show notification:",e)}},[e]);return{permission:e,requestPermission:t,showNotification:n}}},27912:(e,r,t)=>{t.d(r,{V:()=>n});var i=t(95661);let a=null,s=null;function n(){var e;let r=null!=(e=window.MOBILE_CLIENT_VERSION)?e:null,n=!!r;return{getBridge:(0,i.useCallback)(async()=>n?a||(s||(s=(async()=>{try{let{linkBridge:e}=await t.e(9582).then(t.bind(t,39582)),r=e({timeout:6e4});try{Reflect.set(r,"then",void 0)}catch(e){console.warn("[useNativeAppBridge] Unable to remove bridge.then",e)}return a=r,r}catch(e){return s=null,a=null,null}})()),s):null,[n]),isAvailable:n,clientVersion:r}}},32736:(e,r,t)=>{t.d(r,{A:()=>a,M:()=>i});var i=function(e){return e.EXISTING_USER_LOGIN="existingUserLogin",e.SIGNUP="signup",e.SEGMENTATION="segmentation",e}({}),a=function(e){return e.CLAIM_REWARD="claimReward",e.REMIX_PROJECT="remixProject",e}({})},33425:(e,r,t)=>{t.d(r,{d3:()=>c,if:()=>o,o_:()=>d,ou:()=>l});var i=t(18502),a=t(63851),s=t(19620),n=t(21227);let o=async e=>{let r=await e.getIdToken();await fetch("/api/login",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}})},l=async e=>{try{let r=(0,a.P)();return await r.post("/user/sso/join-workspaces"),s.logging.info("SSO workspace auto-join successful",e),!0}catch(r){return s.logging.error("SSO workspace auto-join failed",{error:r,...e}),!1}},c=async()=>{try{let e=(0,a.P)(),r=(0,n.D)();return(await e.post("/user/sso/check-registration",{tracking_data:r})).is_new_registration}catch(e){return s.logging.error("Failed to check SSO registration",{error:e}),!1}},d=e=>{var r,t;let s=(0,a.g)(),{data:n,isLoading:o,error:l}=(0,i.I)({queryKey:["sso-provider",e],queryFn:async()=>{let r=await s.post("/sso/check-sso-provider-id",{display_name_or_provider_id:e});return{provider:r.provider_id,displayName:r.display_name}}});return{isLoadingSSO:o,ssoError:l,ssoProviderId:null!=(r=null==n?void 0:n.provider)?r:e,ssoProviderDisplayName:null!=(t=null==n?void 0:n.displayName)?t:e}}},34056:(e,r,t)=>{t.d(r,{D:()=>P});var i=t(95661),a=t(40702),s=t(67412),n=t(51762),o=t(50444),l=t(69777),c=t(77145),d=t(75417),u=t(169),m=t(62819),p=t(37370),g=t(25253),h=t(19286),f=t(13410),x=t(52597),w=t(52811),j=t(20247),v=t(69730),y=t(77563),b=t(81635),k=t(58295),N=t(50109),I=t(71148);let S=e=>{let{children:r,motionKey:t}=e;return(0,c.jsx)("div",{className:"flex rounded-xl border border-border bg-muted p-4 text-sm",children:(0,c.jsx)(I.P.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-15},transition:{duration:.2,bounce:0,type:"spring"},className:"flex items-center gap-2",children:r},t)})},_=e=>{let{currentJobState:r,isRemixing:t,handleRemix:i,isProjectRemixAllowed:a,hasCustomKnowledge:s,includeHistory:n,includeCustomKnowledge:o,projectRemixNotAllowedReason:l,hasCheckedProjectRemixAllowed:d,handleClose:u,setIncludeHistory:m,setIncludeCustomKnowledge:p}=e,g=(0,f.useRouter)();switch(null==r?void 0:r.status){case"preparing":case"unknown":return(0,c.jsxs)(S,{motionKey:"preparing",children:[(0,c.jsx)(x.y,{size:"small"}),(0,c.jsx)("p",{className:"font-medium",children:"Starting to remix your project"})]});case"running":let h=(0,N.x)(r.step),I="string"==typeof h;return(0,c.jsxs)(S,{motionKey:"running",children:[(0,c.jsx)(x.y,{size:"small"}),I?(0,c.jsx)("p",{className:"font-medium",children:(0,N.x)(r.step)}):h]});case"completed":return(0,c.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,c.jsxs)(S,{motionKey:"completed",children:[(0,c.jsx)(v.I,{name:"check_circle",className:"text-success-primary",size:"small"}),(0,c.jsx)("p",{className:"font-medium",children:"Project remixed successfully"})]}),(0,c.jsx)(j.Es,{className:"w-full",children:(0,c.jsx)(j.HM,{asChild:!0,children:(0,c.jsx)(w.$,{onClick:()=>g.push("/projects/".concat(r.result.project_id)),children:"View project"})})})]});case"error":return(0,c.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,c.jsxs)(S,{motionKey:"error",children:[(0,c.jsx)(v.I,{name:"warning_triangle",className:"text-destructive-primary",size:"small"}),(0,c.jsx)("p",{className:"text-sm font-medium text-destructive-primary",children:"Remix failed. Please try again later."})]}),(0,c.jsxs)(j.Es,{className:"w-full",children:[(0,c.jsx)(j.HM,{asChild:!0,children:(0,c.jsx)(w.$,{variant:"outline",children:"Cancel"})}),(0,c.jsx)(w.$,{onClick:i,loading:t,children:"Try Again"})]})]});default:let _=(0,c.jsx)(w.$,{onClick:i,loading:t,disabled:!a,children:t?"Remixing":"Remix"});return(0,c.jsxs)("div",{"data-testid":"remix-dialog-content",className:"flex flex-col gap-4",children:[(a||!d)&&(0,c.jsxs)("div",{className:"flex w-full items-center justify-between gap-2",children:[(0,c.jsx)(y.Label,{htmlFor:"include-project-history",children:"Include project history"}),(0,c.jsx)(b.d,{id:"include-project-history",disabled:t,checked:n,onCheckedChange:e=>m(e)})]}),s&&(a||!d)&&(0,c.jsxs)("div",{className:"flex w-full items-center justify-between gap-2",children:[(0,c.jsx)(y.Label,{htmlFor:"include-custom-knowledge",children:"Include custom knowledge"}),(0,c.jsx)(b.d,{id:"include-custom-knowledge",disabled:t,checked:o,onCheckedChange:e=>p(e)})]}),!a&&d&&(0,c.jsxs)(S,{motionKey:"error",children:[(0,c.jsx)(v.I,{name:"warning_triangle",className:"text-warning-primary",size:"small"}),(0,c.jsx)("p",{className:"text-sm font-medium text-warning-primary",children:l})]}),(0,c.jsxs)(j.Es,{className:"w-full",children:[(0,c.jsx)(j.HM,{asChild:!0,children:(0,c.jsx)(w.$,{variant:"outline",onClick:u,children:"Cancel"})}),a?_:(0,c.jsxs)(k.m_,{children:[(0,c.jsx)(k.k$,{asChild:!0,children:(0,c.jsx)("span",{className:"inline-flex",children:_})}),(0,c.jsx)(k.ZI,{children:(0,c.jsx)("p",{children:"You can't remix this project."})})]})]})]})}},C={title:"Remix project",description:"By remixing a project, you will create a copy that you own."},R={preparing:{title:"Remixing project",description:"This may take a few moments."},running:{title:"Remixing project",description:"This may take a few moments."},completed:{title:"Remix complete",description:"We're taking you to your new project."},error:{title:"Remix failed",description:"Please try again."},unknown:{title:"Remixing project",description:"This may take a few moments."}},E=e=>{let{project:r,onSuccess:t,initialMessage:a}=e,{showNotification:s}=(0,g.o)(),{startRemixToast:n}=(0,p.G)(),o=(0,i.useRef)(!1),[l,f]=(0,i.useState)(!1),[x,w]=(0,i.useState)(!1),j="custom_instructions"in r&&!!r.custom_instructions,v=r.id,y=r.display_name||r.name||r.id,{mutate:b,isPending:k,currentJobState:N,currentJobId:I}=(0,m.O)({onSuccess:()=>{o.current||(o.current=!0,t(),s("Project remixed successfully",{body:"We're taking you to the new project."}))}}),{isProjectRemixAllowed:S,projectRemixNotAllowedReason:E,hasCheckedProjectRemixAllowed:P}=(0,u.O)({projectId:r.id,enabled:(null==N?void 0:N.status)===void 0}),A=(0,i.useCallback)(()=>{b({projectId:v,includeHistory:l,includeCustomKnowledge:x,initialMessage:a})},[v,l,x,a,b]),O=(0,i.useCallback)(()=>{I&&(null==N?void 0:N.status)!=="completed"&&(null==N?void 0:N.status)!=="error"&&n(v,I,y)},[n,I,v,y,null==N?void 0:N.status]),{title:U,description:D}=(null==N?void 0:N.status)?R[N.status]:C;return(0,c.jsx)(h.T,{title:U,description:D,size:"sm",onClose:O,hideCloseButton:k,children:(0,c.jsx)(d.N,{mode:"popLayout",initial:!1,children:(0,c.jsx)(_,{currentJobState:N,isRemixing:k,handleRemix:A,isProjectRemixAllowed:S,hasCustomKnowledge:j,includeHistory:l,includeCustomKnowledge:x,projectRemixNotAllowedReason:E,hasCheckedProjectRemixAllowed:P,handleClose:O,setIncludeHistory:f,setIncludeCustomKnowledge:w})})})},P=()=>{let e=(0,n.f)(E),r=(0,s.A)(),{authUser:t}=(0,a.Z2)(),{storeAction:c}=(0,o.z)();return(0,i.useCallback)((i,a)=>{if(!t){c(l.A2.REMIX_PROJECT,{projectId:i.id,initialMessage:a},[l.MR.SEGMENTATION,l.MR.EXISTING_USER_LOGIN]),r("signup");return}e({childProps:{project:i,onSuccess:()=>e(!1),initialMessage:a}})},[e,t,r,c])}},37370:(e,r,t)=>{t.d(r,{n:()=>m,G:()=>p});var i=t(77145),a=t(13410),s=t(95661),n=t(31088),o=t(8293),l=t(50109);let c=e=>{let{projectId:r,jobId:t,projectName:i,onComplete:c}=e,d=(0,a.useRouter)(),u="remix-progress-".concat(r),m=(0,s.useRef)(!1),p=(0,s.useRef)(c);(0,s.useEffect)(()=>{p.current=c},[c]);let g=(0,s.useCallback)(e=>{m.current||(m.current=!0,n.toast.success("Remixed '".concat(i,"'"),{id:u,description:"Project remixed successfully",duration:2e4,dismissible:!0,action:{label:"Open project",onClick:()=>{d.push("/projects/".concat(e.project_id,"?remixed=true"))}}}),p.current())},[i,u,d]),h=(0,s.useCallback)(()=>{m.current||(m.current=!0,n.toast.error("Failed to remix '".concat(i,"'"),{id:u,description:"Remix failed. Please try again later.",duration:2e4,dismissible:!0}),p.current())},[i,u]),{currentJobState:f,startPolling:x}=(0,o.O)({onComplete:g,onError:h});return(0,s.useEffect)(()=>{n.toast.loading("Remixing '".concat(i,"'"),{id:u,description:"Starting to remix your project",dismissible:!0,closeButton:!0,action:{label:"Hide",onClick:()=>{n.toast.dismiss(u),p.current()}},onDismiss:()=>{p.current()}}),x(r,t)},[r,t,x,i,u]),(0,s.useEffect)(()=>{f&&!m.current&&"completed"!==f.status&&"error"!==f.status&&("preparing"===f.status||"unknown"===f.status||"running"===f.status)&&n.toast.loading("Remixing '".concat(i,"'"),{id:u,description:"running"===f.status?(0,l.x)(f.step):"Starting to remix your project",dismissible:!0,closeButton:!0,action:{label:"Hide",onClick:()=>{n.toast.dismiss(u),p.current()}},onDismiss:()=>{p.current()}})},[f,u,i]),null};var d=t(19620);let u=(0,s.createContext)(null),m=e=>{let{children:r}=e,t=(0,a.usePathname)(),[o,l]=(0,s.useState)([]),m=(0,s.useCallback)((e,r,t)=>{l(i=>i.some(r=>r.projectId===e)?i:[...i,{projectId:e,jobId:r,projectName:t}])},[]),p=(0,s.useCallback)(function(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];l(r=>r.filter(r=>r.projectId!==e)),r&&n.toast.dismiss("remix-progress-".concat(e))},[]);return(0,s.useEffect)(()=>{if("/"===t)try{let e=localStorage.getItem("pendingRemixJob");if(!e)return;let r=JSON.parse(e);Date.now()-r.timestamp>3e5||m(r.projectId,r.jobId,r.projectName),localStorage.removeItem("pendingRemixJob")}catch(e){d.logging.error("Failed to check for pending remix job")}},[t,m]),(0,i.jsxs)(u.Provider,{value:{startRemixToast:m,stopRemixToast:p},children:[r,o.map(e=>{let{projectId:r,jobId:t,projectName:a}=e;return(0,i.jsx)(c,{projectId:r,jobId:t,projectName:a,onComplete:()=>p(r,!1)},r)})]})},p=()=>{let e=(0,s.useContext)(u);if(!e)throw Error("useRemixProgressToast must be used within RemixProgressToastProvider");return e}},43831:(e,r,t)=>{t.d(r,{F:()=>p});var i=t(75698),a=t(13410),s=t(26294),n=t(95661),o=t(50514),l=t(33425),c=t(87240),d=t(6835),u=t(35418),m=t(27912);let p=e=>{let{referralCode:r}=e,[t,p]=(0,o.A)("lastUsedAuthMethod",{defaultValue:null}),[g,h]=(0,n.useState)(!1),[f,x]=(0,n.useState)(!1),w=(0,s.c3)("Auth"),j=(0,a.useRouter)(),v=(0,c.bl)(),y=(0,c.Vy)(),{signInWithGoogle:b,isNativeAuthAvailable:k,clientVersion:N}=function(){let{getBridge:e,isAvailable:r,clientVersion:t}=(0,m.V)();return{isNativeAuthAvailable:r,signInWithGoogle:(0,n.useCallback)(async()=>{var r;let t=await e();return(null==t?void 0:t.isWebViewBridgeAvailable)&&(null==(r=t.isNativeMethodAvailable)?void 0:r.call(t,"googleSignIn"))?await t.googleSignIn():null},[e]),clientVersion:t}}(),I=(0,n.useCallback)(async(e,t)=>{try{if(p(t),!e)return void(0,d.tu)({error:Error("User credential undefined - possible email conflict or account issue"),title:w("error"),description:w("errors.accountOrEmailIssue"),context:"sign-in with "+t});await (0,l.if)(e.user),j.refresh(),await (0,l.d3)()?(await v(e.user,r),y("/getting-started")):y()}catch(e){console.error(e),(0,d.tu)({error:e,title:w("error"),description:w("errors.accountOrEmailIssue"),context:"sign-in with "+t})}},[p,v,y,r,j]),S=(0,n.useCallback)(async()=>{h(!0);try{if(k){let e=await b();if(!(null==e?void 0:e.idToken))throw Error("No ID token received from native bridge");let r=i.HF.credential(e.idToken),t=await (0,i.eN)(u.auth,r);await I(t,"google")}else{let e=new i.HF;e.addScope("email");let r=await (0,i.df)(u.auth,e);await I(r,"google")}}catch(e){console.error("[handleGoogleSignIn] Error:",e),(0,d.tu)({error:e,title:w("error"),description:w("errors.googleAuthFailed"),context:"google sign-in"})}finally{h(!1)}},[I,w,k,b]),_=(0,n.useCallback)(async()=>{x(!0);try{let e=new i.Dt;e.addScope("user:email");let r=await (0,i.df)(u.auth,e);await I(r,"github")}catch(e){(0,d.tu)({error:e,title:w("error"),description:w("errors.githubAuthFailed"),context:"github sign-in"})}finally{x(!1)}},[I,w]);return{handleSsoPostAuth:I,handleGoogleSignIn:S,handleGithubSignIn:_,googleSignInLoading:g,githubSignInLoading:f,lastUsedMethod:t,clientVersion:N}}},50109:(e,r,t)=>{t.d(r,{x:()=>a});var i=t(77145);let a=e=>{switch(e.step){case"starting":return"Starting to remix your project";case"creating_new_project":return"Creating your new project";case"remixing":default:return"Remixing your project";case"remixing_integration":let r=e.status,t=e.integration_name;return(0,i.jsx)("p",{className:"font-medium",children:r?e.status:t?(0,i.jsxs)("span",{className:"capitalize",children:["Setting up ",e.integration_name]}):(0,i.jsx)("span",{children:"Setting up integrations"})});case"finalizing":return"Finalizing your project"}}},50444:(e,r,t)=>{t.d(r,{z:()=>d});var i=t(87299),a=t(95661),s=t(28717),n=t(49493),o=t(19620),l=t(70556);let c="post-auth-action",d=()=>{let e=(0,i.jE)(),{userData:r}=(0,s.ur)(),t=(0,n.k9)(),{workspaces:d}=(0,n.Mu)(e=>({workspaces:e.workspaces})),u=(0,a.useCallback)((e,r,t)=>{try{let i={key:e,params:r,contexts:t,timestamp:Date.now()},a=l.WS.get(e);if(!a)return void o.logging.error("Unknown post-auth action",{actionKey:e,availableActions:Array.from(l.WS.keys())});let s=a.paramsSchema.safeParse(r);if(!s.success)return void o.logging.error("Invalid params for post-auth action",{actionKey:e,params:r,error:s.error});localStorage.setItem(c,JSON.stringify(i))}catch(r){o.logging.error("Failed to store post-auth action",{error:r,actionKey:e})}},[]),m=(0,a.useCallback)(async(i,a,s)=>{let n=l.WS.get(i);if(!n)return o.logging.error("Unknown post-auth action",{actionKey:i,availableActions:Array.from(l.WS.keys())}),"/";let c=n.paramsSchema.safeParse(a);if(!c.success)return o.logging.error("Invalid params for post-auth action",{actionKey:i,params:a,error:c.error}),"/";let u={userId:null==r?void 0:r.id,workspaces:d,...s},m=await n.execute(c.data,u);if(m.workspaceUpdate&&(null==t?void 0:t.store)){let e=t.store.getState().workspaces.map(e=>e.id===m.workspaceUpdate.workspaceId?{...e,...m.workspaceUpdate.updates}:e);t.store.setState({workspaces:e})}return m.invalidateQueries&&m.invalidateQueries.length>0&&setTimeout(()=>{m.invalidateQueries.forEach(r=>{e.invalidateQueries({queryKey:r})})},2e3),m.redirectUrl||"/"},[e,r,t,d]);return{storeAction:u,executeStoredAction:(0,a.useCallback)(async()=>{try{let e=localStorage.getItem(c);if(!e)return"/";let r=JSON.parse(e),t=l.th.safeParse(r);if(!t.success)return o.logging.error("Invalid stored action",{error:t.error}),localStorage.removeItem(c),"/";let i=t.data;if(i.timestamp&&Date.now()-i.timestamp>864e5)return localStorage.removeItem(c),"/";let a=await m(i.key,i.params);return localStorage.removeItem(c),a}catch(e){if(localStorage.removeItem(c),o.logging.error("Failed to execute stored action",{error:e}),e instanceof Error)throw e;throw Error("Unknown error occurred while executing stored action",{cause:e})}},[m]),executeAction:m,shouldRunAction:(0,a.useCallback)(e=>{try{let r=localStorage.getItem(c);if(!r)return!1;let t=JSON.parse(r),i=l.th.safeParse(t);if(!i.success)return localStorage.removeItem(c),!1;return i.data.contexts.includes(e)}catch(r){return o.logging.error("Failed to check if action should run",{error:r,context:e}),!1}},[])}}},61884:(e,r,t)=>{t.d(r,{P:()=>i});let i=(0,t(84510).vt)(e=>({shouldShowReferralNotice:!1,setIsSuccessfulReferral:()=>e({shouldShowReferralNotice:!0})}))},62548:(e,r,t)=>{t.d(r,{g:()=>i});var i=function(e){return e.USER_UPLOAD="user_upload",e.IFRAME_SNAPSHOT="iframe_snapshot",e}({})},62819:(e,r,t)=>{t.d(r,{O:()=>p});var i=t(6698),a=t(95661),s=t(31088),n=t(40702),o=t(83220),l=t(67412),c=t(83473),d=t(63851),u=t(19620),m=t(8293);let p=e=>{let{onSuccess:r,onError:t}=e,{authUser:p}=(0,n.Z2)(),g=(0,l.A)(),[h,f]=(0,a.useState)(!1),{currentUserSelectedWorkspaceId:x}=(0,o.Dx)(),[w,j]=(0,a.useState)(null),{currentJobState:v,startPolling:y}=(0,m.O)({shouldNavigate:!0,onComplete:e=>{f(!1),null==r||r()},onError:()=>{f(!1),null==t||t()}}),{mutate:b,isPending:k}=(0,i.n)({mutationFn:async e=>{let{projectId:r,includeHistory:t=!1,includeCustomKnowledge:i=!1,initialMessage:a}=e;if(!p)return void g("signup");if(!x)return void s.toast.error("You need to be in a workspace to remix projects");let n=await (0,d.P)().post("/projects/".concat(r,"/remix/init"),{include_history:t,include_custom_knowledge:i,workspace_id:x,initial_message:a});if(!(null==n?void 0:n.job_id))throw Error("Failed to get job ID from remix init");return{projectId:r,jobId:n.job_id}},onSuccess:e=>{if(!(null==e?void 0:e.jobId))return;let{projectId:r,jobId:t}=e;j(t),f(!0),y(r,t)},onError:(e,r)=>{let{projectId:i}=r;u.logging.error("Error remixing project",{projectId:i,error:e}),(0,c.Ni)(e),null==t||t()}});return{mutate:b,isPending:h||k&&!!p,currentJobState:v,currentJobId:w}}},67412:(e,r,t)=>{t.d(r,{A:()=>w});var i=t(77145),a=t(46753),s=t.n(a),n=t(13410),o=t(26294),l=t(95661),c=t(52811),d=t(20247),u=t(27458),m=t(21016),p=t(43831),g=t(56455),h=t(56024),f=t(35418),x=t(51762);let w=()=>{let e=(0,x.f)(j),r=(0,n.useRouter)(),t=(0,m.A)("md"),i=(0,l.useMemo)(()=>(0,g.t9)(),[]);return(0,l.useCallback)(async a=>{if(t){let e="".concat("login"===a?"/login":"/signup","?should-refresh-credentials=1");if(i){try{await fetch("/api/logout"),await f.auth.signOut()}catch(e){}window.location.assign(e)}else r.push(e);return}e({childProps:{type:a||"login"}})},[e,t,i,r])},j=e=>{let{type:r}=e,t=(0,n.useSearchParams)(),a=(0,o.c3)("AuthDialog"),l=(0,o.c3)("Auth"),m=t.get("referral_code"),{handleGoogleSignIn:g,handleGithubSignIn:f,googleSignInLoading:x,githubSignInLoading:w,lastUsedMethod:j}=(0,p.F)({referralCode:m});return(0,i.jsxs)(d.Cf,{className:"max-h-[90vh] overflow-y-auto bg-popover",size:"sm",children:[(0,i.jsxs)("div",{className:"flex flex-col items-start justify-start gap-4",children:[(0,i.jsx)(u.Fy,{className:"h-9 w-9"}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)(d.L3,{className:"text-3xl font-medium",children:a("title")}),(0,i.jsx)(d.rr,{className:"-mt-2 text-3xl font-medium text-muted-foreground/50",children:a("login"==r?"logInDescription":"signUpDescription")})]})]}),(0,i.jsxs)("div",{className:"mt-2 flex flex-col gap-4",children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)(c.$,{onClick:g,variant:"outline",loading:x,disabled:w,className:(0,h.cn)("relative flex w-full items-center justify-center","google"===j&&"border border-affirmative-primary shadow-none"),children:[(0,i.jsx)(u.gu,{name:"Google",className:"absolute left-4 h-4 w-4 flex-shrink-0"}),(0,i.jsx)("span",{children:l("continueWithGoogle")})]}),"google"===j&&(0,i.jsx)("div",{className:"absolute -right-2 -top-2",children:(0,i.jsx)("span",{className:"rounded-lg border border-affirmative-primary bg-affirmative px-1.5 py-0.5 text-xs text-affirmative-foreground shadow-md",children:l("lastUsed")})})]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)(c.$,{onClick:f,variant:"outline",loading:w,disabled:x,className:(0,h.cn)("relative flex w-full items-center justify-center","github"===j&&"border border-affirmative-primary shadow-none"),children:[(0,i.jsx)(u.gu,{name:"GitHub",className:"absolute left-4 h-4 w-4 flex-shrink-0"}),a("continueWithGitHub")]}),"github"===j&&(0,i.jsx)("div",{className:"absolute -right-2 -top-2",children:(0,i.jsx)("span",{className:"rounded-lg border border-affirmative-primary bg-affirmative px-1.5 py-0.5 text-xs text-affirmative-foreground shadow-md",children:l("lastUsed")})})]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,i.jsx)("span",{className:"w-full border-t"})}),(0,i.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,i.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:l("or")})})]}),(0,i.jsx)(c.$,{className:"w-full",variant:"default",id:"email-login-button",asChild:!0,children:(0,i.jsx)(s(),{href:"".concat("login"===r?"/login":"/signup"),children:a("continueWithEmail")})}),"signup"===r&&(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:l.rich("byContinuingSignup",{termsLink:e=>(0,i.jsx)(s(),{href:"/terms",className:"underline underline-offset-4 hover:text-primary",children:e}),privacyLink:e=>(0,i.jsx)(s(),{href:"/privacy",className:"underline underline-offset-4 hover:text-primary",children:e})})})]})]})}},69777:(e,r,t)=>{t.d(r,{A2:()=>i.A,MR:()=>i.M});var i=t(32736);t(70556),t(11070)},70556:(e,r,t)=>{t.d(r,{WS:()=>o,th:()=>l});var i=t(75222),a=t(11070),s=t(32736);let n=[a.K,a.N],o=new Map;n.forEach(e=>{o.set(e.key,e)}),Object.fromEntries(n.map(e=>[e.key,e.paramsSchema]));let l=i.gM("key",n.map(e=>{let r,t;return r=e.key,t=e.paramsSchema,i.Ik({key:i.eu(r),params:t.optional(),contexts:i.YO(i.fc(s.M)),timestamp:i.ai().optional()})}))},87240:(e,r,t)=>{t.d(r,{Vy:()=>g,bU:()=>f,bl:()=>h,lq:()=>p});var i=t(13410),a=t(95661),s=t(50444),n=t(83473),o=t(63851),l=t(19620),c=t(69777),d=t(5361),u=t(61884);let m="pending-collaboration-invite",p=()=>{let[e,r]=(0,a.useState)(null);return(0,a.useEffect)(()=>{try{let e=sessionStorage.getItem(m);if(e){let t=JSON.parse(e);r(t)}}catch(e){l.logging.error("Error reading pending collaboration invite:",{error:e})}},[]),{pendingInvite:e,clearPendingInvite:(0,a.useCallback)(()=>{sessionStorage.removeItem(m),r(null)},[])}},g=()=>{let e=(0,i.useSearchParams)(),{pendingInvite:r,clearPendingInvite:t}=p(),{shouldRunAction:n}=(0,s.z)();return(0,a.useCallback)((i,a)=>{if(n(c.MR.EXISTING_USER_LOGIN)){window.location.href="/auth/post-login";return}if(r){let e="".concat(r.projectUrl,"?magic_link=").concat(r.magicLink);t(),window.location.href=e;return}let s=(e=>{let r=null==e?void 0:e.get("redirect"),t=r?decodeURIComponent(r):null,i=new URL((0,d.S)(t||"/")||"/",window.location.origin);return i.searchParams.set("should-refresh-credentials","1"),i})(e),o=new URLSearchParams(e);if(i){if((null==a?void 0:a.preserveRedirect)===!1?(o.delete("redirect"),o.set("should-refresh-credentials","1")):o.set("redirect",s.pathname+s.search),i.includes("?")){window.location.href=i+"&".concat(o.toString());return}window.location.href=i+"?".concat(o.toString());return}window.location.href=s.pathname+s.search},[e,r,t,n])},h=()=>{let{setIsSuccessfulReferral:e}=(0,u.P)();return(0,a.useCallback)(async(r,t)=>{if(!t)return;let i=(0,o.g)();try{let a=await r.getIdToken();await i.post("/user/referral-code/use",{referral_code:t},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}),e()}catch(r){let e=(0,n.yO)(r);400===e.status&&(e.message=e.message||"Invalid referral code",e.details="Your sign-up will proceed without the referral bonus."),(0,n.Ni)(e)}},[e])},f=()=>{let[e,r]=(0,a.useState)(!1),[t,i]=(0,a.useState)(null);return{checkAuthProvider:(0,a.useCallback)(async e=>{if(!e||!e.includes("@"))return i(null),null;r(!0);try{let r=(0,o.g)(),t=await r.post("/auth/check-auth-provider",{email:e}),a={hasSSOProvider:t.has_sso_provider,ssoProviderID:t.sso_provider_id,ssoDisplayName:t.sso_display_name,workspaceID:t.workspace_id,firebaseProviders:t.firebase_providers||[],hasEmailPassword:t.has_email_password,recommendedProvider:t.recommended_provider};return i(a),a}catch(r){console.error("Error checking auth provider:",r),(0,n.Ni)({message:"Unable to verify your account settings",details:"You can still sign in with your email and password.",status:500});let e={hasSSOProvider:!1,ssoProviderID:void 0,ssoDisplayName:void 0,workspaceID:void 0,firebaseProviders:[],hasEmailPassword:!1,recommendedProvider:void 0};return i(e),e}finally{r(!1)}},[]),isChecking:e,authProvider:t,setAuthProvider:i}}}}]);